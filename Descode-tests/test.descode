var DeltaTime = 0;
var Timer = 0;

var Error = 0;
var Derivative = 0;
var PastError = 0;
var Integral = 0;

var P = 0;
var I = 0;
var D = 0;

var Speed = 0;
var AccelRate = 1.01;

var GroundResetPoint = 0;

var MaxMovement = 3;

var InputRight = (4,-4);
var InputLeft = (-4,-4);

var GroundPos = (0,0,0)
var GroundPosA = [(GroundPos.x,GroundPos.y,GroundPos.z)];

var Roadblocks = [(0,0,100),(0,0,100)];

var CarPos = (0,0,0);
var TargetCarPos = (0,0,0);

function Update() {
    Timer = Timer+DeltaTime;
    UpdateCarPos()
    moveGround()
    GetInput(0)
    SpeedUp()
    RoadBlocks()
}

function UpdateCarPos() {
    PastError = Error;
    Error = TargetCarPos.x-CarPos.x;
    Integral = Integral + Error * DeltaTime/1000;
    Derivative = (Error - PastError)/DeltaTime/1000;
    CarPos = (CarPos.x+(Error*P) + (Integral*I) + (Derivative*D),0,0);
}

function moveGround() {
    if (GroundPos.y <= GroundResetPoint) {
        GroundPos = (0,-GroundResetPoint,0);
    } else {
        GroundPos = (0,GroundPos.y-1*Speed,0);
    }
}

function GetInput(input) {
    if (TargetCarPos.x >= MaxMovement) {
        TargetCarPos = (MaxMovement-1,0,0);
    } else if (TargetCarPos.x <= -MaxMovement) {
        TargetCarPos = (-MaxMovement+1,0,0);
    } else {
        TargetCarPos = (TargetCarPos.x+input,0,0);
    }
}

function RoadBlocks() {
    if (GroundPos.y <= GroundResetPoint) {
        Roadblocks = (Math.round(Math.random(2)*6)-3,GroundPos.y+2,1);
    } else {
        Roadblocks = (Roadblocks.x,GroundPos.y,Roadblocks.z);
    }
}

function SpeedUp() {
    Speed = Speed * AccelRate;
}


ticker(0) {
    Update()
    DeltaTime = Math.dt;
}